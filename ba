#!/bin/bash

# BA-Kit Unified CLI Wrapper
# Usage: ./ba [command] [args]

TOOLS_DIR="tools"

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
RED='\033[0;31m'
NC='\033[0m' # No Color

function show_help {
    echo -e "${BLUE}üöÄ Antigravity BA-Kit CLI${NC}"
    echo "Usage: ./ba [command] [args]"
    echo ""
    echo "Phase 1-4 Commands:"
    echo "  doctor       üè• Run full project health check (Metrics + Report)"
    echo "  lint         üßπ Lint requirements (Basic)"
    echo "  check        üß† Expert Lint (invest/gherkin)"
    echo "  gap          üïµÔ∏è Analyze Traceability Gaps"
    echo "  gen [file]   ‚ö° Generate Playwright Tests"
    echo "  graph        üï∏Ô∏è Update Knowledge Graph"
    echo "  struct [file]üìù Structurize Notes (Text -> Table)"
    echo ""
    echo "Phase 5 Commands (Proactive Intelligence):"
    echo "  story        ü™Ñ Generate User Story from text (--text \"...\")"
    echo "  consistency  üîó Check cross-document attribute consistency"
    echo "  log          üìú Log a decision (--id ID --reason \"...\")"
    echo "  why          ‚ùì Query decision history (--id ID)"
    echo "  impact       üîÆ Simulate removal impact (ID)"
    echo ""
    echo "SKILL-21 Commands (Enterprise Export):"
    echo "  export       üì§ Export MD to DOCX (--customer profile)"
    echo "  validate-export üîç Pre-flight check before export"
    echo ""
}

if [ -z "$1" ]; then
    show_help
    exit 1
fi

COMMAND=$1
shift # Shift args so $1 becomes the first arg for the script

case $COMMAND in
    doctor)
        echo -e "${GREEN}Running Global Health Check...${NC}"
        python3 $TOOLS_DIR/metrics_dashboard.py --path .
        echo ""
        echo -e "${GREEN}Generating Quality Certificate...${NC}"
        python3 $TOOLS_DIR/gen_report.py
        ;;
    lint)
        python3 $TOOLS_DIR/lint_req.py "$@"
        ;;
    check)
        python3 $TOOLS_DIR/lint_expert.py "$@"
        ;;
    gap)
        python3 $TOOLS_DIR/gap_analyst.py --path .
        ;;
    gen)
        python3 $TOOLS_DIR/gen_test_playwright.py "$@"
        ;;
    graph)
        python3 $TOOLS_DIR/knowledge_graph.py --path .
        ;;
    struct)
        python3 $TOOLS_DIR/structure_notes.py "$@"
        ;;
    story)
        python3 $TOOLS_DIR/gen_story.py "$@"
        ;;
    consistency)
        python3 $TOOLS_DIR/consistency_checker.py --path .
        ;;
    log)
        python3 $TOOLS_DIR/decision_log.py log "$@"
        ;;
    why)
        python3 $TOOLS_DIR/decision_log.py why "$@"
        ;;
    impact)
        python3 $TOOLS_DIR/impact_sim.py "$@"
        ;;
    export)
        python3 $TOOLS_DIR/gen_docx.py "$@"
        ;;
    validate-export)
        python3 $TOOLS_DIR/validate_export.py "$@"
        ;;
    *)
        echo -e "${RED}Unknown command: $COMMAND${NC}"
        show_help
        exit 1
        ;;
esac
